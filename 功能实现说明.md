# å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ - åŠŸèƒ½å®ç°è¯¦ç»†è¯´æ˜

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºQtæ¡†æ¶å¼€å‘çš„ç°ä»£åŒ–å›¾ä¹¦ç®¡ç†ç³»ç»Ÿï¼Œé‡‡ç”¨å•ä¾‹æ¨¡å¼è®¾è®¡ï¼Œæ”¯æŒå¤šç”¨æˆ·è§’è‰²ï¼ˆç®¡ç†å‘˜/å­¦ç”Ÿï¼‰ï¼Œå…·å¤‡å®Œæ•´çš„å›¾ä¹¦å€Ÿé˜…ç®¡ç†åŠŸèƒ½ã€‚

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Qt6.9.3
- **è¯­è¨€**: C++20
- **æ•°æ®åº“**: JSONæ–‡ä»¶å­˜å‚¨
- **è®¾è®¡æ¨¡å¼**: å•ä¾‹æ¨¡å¼ã€MVCæ¶æ„
- **UI**: Qt Widgets + CSSæ ·å¼

---

## 1. ç”¨æˆ·ç™»å½•ä¸æƒé™ç®¡ç†

### 1.1 ç™»å½•æ³¨å†ŒåŠŸèƒ½

**æ–‡ä»¶ä½ç½®**: `src/widget/mainwindow.cpp` - `MainWindow::setCurrentUser()`

**å®ç°æ€è·¯æµç¨‹**:
1. **ç”¨æˆ·éªŒè¯**: ä»JSONæ–‡ä»¶ä¸­è¯»å–ç”¨æˆ·æ•°æ®ï¼ŒéªŒè¯ç”¨æˆ·åæ˜¯å¦å­˜åœ¨
2. **è§’è‰²è¯†åˆ«**: æ ¹æ®JSONæ•°æ®ä¸­çš„`isAdmin`å­—æ®µåˆ¤æ–­ç”¨æˆ·è§’è‰²
3. **æƒé™åˆ†é…**: æ ¹æ®ç”¨æˆ·è§’è‰²æ˜¾ç¤º/éšè—ä¸åŒçš„åŠŸèƒ½æŒ‰é’®
4. **ç•Œé¢æ›´æ–°**: è°ƒç”¨`updateActionsVisibility()`æ›´æ–°UIæ˜¾ç¤º

**æ ¸å¿ƒå‡½æ•°**:
```cpp
void MainWindow::setCurrentUser(const QString &username, bool isAdminMode, const QString &usersFilePath)
```

**æ¶‰åŠæ•°æ®ç»“æ„**:
- ç”¨æˆ·æ•°æ®å­˜å‚¨åœ¨JSONæ–‡ä»¶ä¸­
- æ¯ä¸ªç”¨æˆ·åŒ…å«ï¼šusername, password, isAdmin, allowedCategoriesç­‰å­—æ®µ

**æƒé™æ§åˆ¶å®ç°**:
```cpp
void MainWindow::updateActionsVisibility()
{
    // ç®¡ç†å‘˜ç‰¹æƒåŠŸèƒ½
    addBookAct_->setVisible(isAdminMode_);
    editBookAct_->setVisible(isAdminMode_);
    deleteBookAct_->setVisible(isAdminMode_);
    manageCopiesAct_->setVisible(isAdminMode_);
    bookHistoryAct_->setVisible(isAdminMode_);

    // å­¦ç”ŸåŠŸèƒ½
    borrowAct_->setVisible(!isAdminMode_);
    returnAct_->setVisible(!isAdminMode_);
    myBorrowAct_->setVisible(!isAdminMode_);
}
```

---

## 2. å›¾ä¹¦ç®¡ç†åŠŸèƒ½

### 2.1 å›¾ä¹¦ä¿¡æ¯ç®¡ç†

**æ–‡ä»¶ä½ç½®**: `src/utils/librarymanager.cpp`

**æ ¸å¿ƒæ•°æ®ç»“æ„**:
```cpp
struct Book {
    QString indexId;          // ç´¢å¼•å·ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
    QString name;             // ä¹¦å
    QString author;           // ä½œè€…
    QString publisher;        // å‡ºç‰ˆç¤¾
    QString location;         // é¦†è—åœ°å€ï¼ˆä¸‰ç‰Œæ¥¼/ä»™æ—ï¼‰
    QString category;         // ç±»åˆ«ï¼ˆäººæ–‡/ç§‘æŠ€/å¤–è¯­ç­‰ï¼‰
    double price;             // ä»·æ ¼
    QDate inDate;             // å…¥åº“æ—¥æœŸ
    int borrowCount;          // å€Ÿé˜…æ¬¡æ•°
};
```

### 2.2 å›¾ä¹¦å‰¯æœ¬ç®¡ç†

**è®¾è®¡ç†å¿µ**: å¼•å…¥å‰¯æœ¬æ¦‚å¿µï¼Œå®ç°ç²¾ç¡®çš„å€Ÿé˜…ç®¡ç†

**æ ¸å¿ƒæ•°æ®ç»“æ„**:
```cpp
struct BookCopy {
    QString copyId;           // å‰¯æœ¬å”¯ä¸€æ ‡è¯† (æ ¼å¼: indexId_copyNumber)
    QString indexId;          // å›¾ä¹¦ç´¢å¼•å·
    int copyNumber;           // ç¼–å· (ä»1å¼€å§‹)
    QString borrowedBy;       // å€Ÿé˜…è€…ç”¨æˆ·å (ç©ºè¡¨ç¤ºæœªè¢«å€Ÿé˜…)
    QDate borrowDate;         // å€Ÿé˜…æ—¥æœŸ
    QDate dueDate;           // å½’è¿˜æ—¥æœŸ
    bool isAvailable() const { return borrowedBy.isEmpty(); }
};
```

**æ ¸å¿ƒå‡½æ•°**:
```cpp
// è·å–å›¾ä¹¦çš„æ‰€æœ‰å‰¯æœ¬
QVector<BookCopy> LibraryManager::getBookCopies(const QString &indexId);

// è·å–å¯ç”¨å‰¯æœ¬
QVector<BookCopy> LibraryManager::getAvailableCopies(const QString &indexId);

// è·å–ç”¨æˆ·å·²å€Ÿå‰¯æœ¬
QVector<BookCopy> LibraryManager::getUserBorrowedCopies(const QString &username);
```

---

## 3. å€Ÿä¹¦åŠŸèƒ½è¯¦ç»†å®ç°

### 3.1 å€Ÿä¹¦æµç¨‹

**æ–‡ä»¶ä½ç½®**: `src/widget/mainwindow.cpp` - `MainWindow::onBorrow()`

**å®ç°æµç¨‹**:
1. **æƒé™éªŒè¯**: æ£€æŸ¥æ˜¯å¦ä¸ºå­¦ç”Ÿç”¨æˆ·
2. **é€‰æ‹©éªŒè¯**: ç¡®è®¤ç”¨æˆ·é€‰æ‹©äº†å›¾ä¹¦
3. **é‡å¤æ£€æŸ¥**: é˜²æ­¢å­¦ç”Ÿé‡å¤å€Ÿé˜…åŒä¸€æœ¬ä¹¦
4. **å‰¯æœ¬æ£€æŸ¥**: è·å–è¯¥å›¾ä¹¦çš„æ‰€æœ‰å¯ç”¨å‰¯æœ¬
5. **ç”¨æˆ·äº¤äº’**: æ˜¾ç¤ºå€Ÿä¹¦å¯¹è¯æ¡†é€‰æ‹©å…·ä½“å‰¯æœ¬
6. **ä¸šåŠ¡å¤„ç†**: æ‰§è¡Œå€Ÿä¹¦æ“ä½œ
7. **ç•Œé¢æ›´æ–°**: åˆ·æ–°æ˜¾ç¤º

**å…³é”®å‡½æ•°è°ƒç”¨é“¾**:
```
MainWindow::onBorrow()
â”œâ”€â”€ library_.findByIndexId()           // æŸ¥æ‰¾å›¾ä¹¦ä¿¡æ¯
â”œâ”€â”€ library_.getUserBorrowedCopies()   // è·å–ç”¨æˆ·å·²å€Ÿå‰¯æœ¬
â”œâ”€â”€ library_.getAvailableCopies()      // è·å–å¯ç”¨å‰¯æœ¬åˆ—è¡¨
â”œâ”€â”€ BorrowDialog::exec()               // æ˜¾ç¤ºå€Ÿä¹¦å¯¹è¯æ¡†
â””â”€â”€ library_.borrowBook()              // æ‰§è¡Œå€Ÿä¹¦æ“ä½œ
```

### 3.2 å€Ÿä¹¦å¯¹è¯æ¡†

**æ–‡ä»¶ä½ç½®**: `src/widget/borrowdialog.h/.cpp`

**åŠŸèƒ½ç‰¹æ€§**:
- æ˜¾ç¤ºå›¾ä¹¦è¯¦ç»†ä¿¡æ¯ï¼ˆä¹¦åã€ç´¢å¼•å·ã€ä½œè€…ã€å‡ºç‰ˆç¤¾ï¼‰
- åˆ—å‡ºæ‰€æœ‰å¯ç”¨å‰¯æœ¬ä¾›ç”¨æˆ·é€‰æ‹©
- æä¾›æ—¥æœŸé€‰æ‹©å™¨è®¾ç½®å½’è¿˜æ—¥æœŸï¼ˆ1-90å¤©ï¼‰
- å®æ—¶éªŒè¯ç”¨æˆ·è¾“å…¥çš„æœ‰æ•ˆæ€§
- å“åº”å¼ç•Œé¢è®¾è®¡

**æ ¸å¿ƒæ–¹æ³•**:
```cpp
class BorrowDialog : public QDialog {
public:
    BookCopy getSelectedCopy() const;  // è·å–é€‰ä¸­çš„å‰¯æœ¬
    QDate getDueDate() const;          // è·å–å½’è¿˜æ—¥æœŸ

private slots:
    void validateInput();              // è¾“å…¥éªŒè¯
};
```

---

## 4. è¿˜ä¹¦åŠŸèƒ½è¯¦ç»†å®ç°

### 4.1 è¿˜ä¹¦æµç¨‹

**æ–‡ä»¶ä½ç½®**: `src/widget/mainwindow.cpp` - `MainWindow::onReturn()`

**æ™ºèƒ½æ’åºè®¾è®¡**:
```cpp
// æŒ‰åˆ°æœŸæ—¥æœŸæ’åºï¼Œæœ€å…ˆåˆ°æœŸçš„æ’åœ¨å‰é¢
std::sort(borrowedCopies.begin(), borrowedCopies.end(),
          [](const BookCopy &a, const BookCopy &b) {
              return a.dueDate < b.dueDate;
          });
```

**å®ç°æµç¨‹**:
1. **æƒé™éªŒè¯**: æ£€æŸ¥æ˜¯å¦ä¸ºå­¦ç”Ÿç”¨æˆ·
2. **æ•°æ®è·å–**: è·å–ç”¨æˆ·æ‰€æœ‰å·²å€Ÿå‰¯æœ¬
3. **æ™ºèƒ½æ’åº**: æŒ‰åˆ°æœŸæ—¥æœŸæ’åºæ˜¾ç¤º
4. **çŠ¶æ€è®¡ç®—**: è®¡ç®—å‰©ä½™å¤©æ•°æˆ–è¿‡æœŸå¤©æ•°
5. **ç”¨æˆ·é€‰æ‹©**: æ˜¾ç¤ºå€Ÿé˜…åˆ—è¡¨ä¾›é€‰æ‹©
6. **ç¡®è®¤æ“ä½œ**: é˜²æ­¢è¯¯æ“ä½œçš„ç¡®è®¤å¯¹è¯æ¡†
7. **ä¸šåŠ¡å¤„ç†**: æ‰§è¡Œè¿˜ä¹¦æ“ä½œ
8. **ç•Œé¢æ›´æ–°**: åˆ·æ–°è¡¨æ ¼æ˜¾ç¤º

**çŠ¶æ€æ˜¾ç¤ºé€»è¾‘**:
```cpp
QDate currentDate = QDate::currentDate();
if (copy.dueDate < currentDate) {
    // å·²è¿‡æœŸ
    statusText = QStringLiteral(" (å·²è¿‡æœŸ %1 å¤©)").arg(currentDate.daysTo(copy.dueDate));
} else {
    // å‰©ä½™å¤©æ•°
    statusText = QStringLiteral(" (å‰©ä½™ %1 å¤©)").arg(currentDate.daysTo(copy.dueDate));
}
```

---

## 5. æœç´¢ä¸ç­›é€‰åŠŸèƒ½

### 5.1 æœç´¢åŠŸèƒ½

**æ–‡ä»¶ä½ç½®**: `src/widget/mainwindow.cpp` - `MainWindow::onSearch()`

**æ”¯æŒæœç´¢æ¨¡å¼**:
1. **ç´¢å¼•å·æœç´¢**: ç²¾ç¡®åŒ¹é…ç´¢å¼•å·
2. **ä¹¦åæœç´¢**: æ¨¡ç³ŠåŒ¹é…ä¹¦å
3. **ä½œè€…æœç´¢**: æ¨¡ç³ŠåŒ¹é…ä½œè€…
4. **å‡ºç‰ˆç¤¾æœç´¢**: æ¨¡ç³ŠåŒ¹é…å‡ºç‰ˆç¤¾

**æ ¸å¿ƒç®—æ³•**:
```cpp
void MainWindow::performFuzzySearch(const QString &keyword, const QString &searchMode)
{
    QVector<Book> searchResults;

    if (searchMode == "indexId") {
        // ç´¢å¼•å·ç²¾ç¡®åŒ¹é…
        const Book *book = library_.findByIndexId(keyword);
        if (book) searchResults.append(*book);
    } else {
        // å…¶ä»–æ¨¡å¼æ¨¡ç³Šæœç´¢
        searchResults = library_.searchBooks(keyword);

        // äºŒæ¬¡ç­›é€‰ç¡®ä¿æœç´¢æ¨¡å¼å‡†ç¡®æ€§
        searchResults.erase(std::remove_if(searchResults.begin(), searchResults.end(),
            [&](const Book &book) {
                return !matchSearchMode(book, keyword, searchMode);
            }), searchResults.end());
    }
}
```

### 5.2 ç­›é€‰åŠŸèƒ½

**æ–‡ä»¶ä½ç½®**: `src/widget/mainwindow.cpp` - `MainWindow::rebuildFilterMenus()`

**æ”¯æŒçš„ç­›é€‰ç»´åº¦**:
1. **ç±»åˆ«ç­›é€‰**: äººæ–‡/ç§‘æŠ€/å¤–è¯­/è®¡ç®—æœºç§‘å­¦/å†å²/ç§‘å­¦/è‰ºæœ¯/å“²å­¦
2. **çŠ¶æ€ç­›é€‰**: å…¨éƒ¨/ä»…å¯å€Ÿ/ä»…ä¸å¯å€Ÿ
3. **ä½ç½®ç­›é€‰**: å…¨éƒ¨/ä¸‰ç‰Œæ¥¼/ä»™æ—
4. **æ’åºæ–¹å¼**: é»˜è®¤/æŒ‰å€Ÿé˜…æ¬¡æ•°æ’åº

**ç­›é€‰é€»è¾‘å®ç°**:
```cpp
// åº”ç”¨ç­›é€‰æ¡ä»¶
if (!categoryFilter_.isEmpty() && book.category != categoryFilter_) {
    continue;
}
if (statusFilter_ == "available" && availableCopies <= 0) {
    continue;  // åªæ˜¾ç¤ºæœ‰å¯ç”¨å‰¯æœ¬çš„å›¾ä¹¦
}
if (statusFilter_ == "borrowed" && availableCopies >= totalCopies) {
    continue;  // åªæ˜¾ç¤ºæ²¡æœ‰å¯ç”¨å‰¯æœ¬çš„å›¾ä¹¦
}
```

**åŠ¨æ€èœå•åˆ›å»º**:
```cpp
auto addCategoryAction = [this](const QString &label, const QString &value) {
    QAction *action = categoryFilterMenu_->addAction(label);
    action->setCheckable(true);
    action->setData(value);
    categoryActionGroup_->addAction(action);
    return action;
};
```

---

## 6. å€Ÿé˜…è®°å½•ç®¡ç†

### 6.1 å­¦ç”Ÿå€Ÿé˜…è®°å½•

**æ–‡ä»¶ä½ç½®**: `src/widget/mainwindow.cpp` - `MainWindow::onShowMyBorrows()`

**åŠŸèƒ½ç‰¹æ€§**:
- æ˜¾ç¤ºç”¨æˆ·æ‰€æœ‰å€Ÿé˜…çš„å‰¯æœ¬è¯¦æƒ…
- æŒ‰åˆ°æœŸæ—¥æœŸæ’åºæ˜¾ç¤º
- ç”¨å›¾æ ‡æ ‡è¯†å€Ÿé˜…çŠ¶æ€ï¼ˆğŸ”´è¿‡æœŸã€ğŸŸ¡å³å°†åˆ°æœŸã€ğŸŸ¢æ­£å¸¸ï¼‰
- è®¡ç®—å¹¶æ˜¾ç¤ºå‰©ä½™å¤©æ•°

**çŠ¶æ€æ ‡è¯†é€»è¾‘**:
```cpp
QString statusIcon;
QDate currentDate = QDate::currentDate();
int daysDiff = currentDate.daysTo(copy.dueDate);

if (daysDiff < 0) {
    statusIcon = "ğŸ”´"; // å·²è¿‡æœŸ
} else if (daysDiff <= 3) {
    statusIcon = "ğŸŸ¡"; // å³å°†åˆ°æœŸ
} else {
    statusIcon = "ğŸŸ¢"; // æ­£å¸¸
}
```

### 6.2 ç®¡ç†å‘˜å€Ÿé˜…è®°å½•

**æ–‡ä»¶ä½ç½®**: `src/widget/mainwindow.cpp` - `MainWindow::onShowBookBorrowHistory()`

**åŠŸèƒ½ç‰¹æ€§**:
- æ˜¾ç¤ºæŒ‡å®šå›¾ä¹¦çš„æ‰€æœ‰å‰¯æœ¬çŠ¶æ€
- åŒºåˆ†å¯å€Ÿå’Œå·²å€Ÿå‰¯æœ¬
- æ˜¾ç¤ºå€Ÿé˜…è€…ä¿¡æ¯å’Œå‰©ä½™å¤©æ•°
- ç»Ÿè®¡å‰¯æœ¬æ€»æ•°å’Œå€Ÿé˜…æƒ…å†µ

**å®ç°æµç¨‹**:
```cpp
// è·å–æ‰€æœ‰å‰¯æœ¬
QVector<BookCopy> allCopies = library_.getBookCopies(indexId);

// ç»Ÿè®¡å‰¯æœ¬çŠ¶æ€
int borrowedCount = 0;
int availableCount = 0;
QVector<BookCopy> borrowedCopies;

for (const BookCopy &copy : allCopies) {
    if (copy.isAvailable()) {
        availableCount++;
    } else {
        borrowedCount++;
        borrowedCopies.append(copy);
    }
}
```

---

## 7. æ•°æ®æŒä¹…åŒ–

### 7.1 æ•°æ®å­˜å‚¨ç»“æ„

**å›¾ä¹¦æ•°æ®æ–‡ä»¶**: `src/resource/library_data.json`

**JSONç»“æ„**:
```json
[
    {
        "indexId": "CS001",
        "name": "C++ç¨‹åºè®¾è®¡æ•™ç¨‹",
        "author": "è°­æµ©å¼º",
        "publisher": "æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾",
        "location": "ä»™æ—å›¾ä¹¦é¦†",
        "category": "è®¡ç®—æœºç§‘å­¦",
        "price": 45.80,
        "inDate": "2023-01-15",
        "borrowCount": 12
    }
]
```

**å‰¯æœ¬æ•°æ®æ–‡ä»¶**: `src/resource/book_copies.json`

**JSONç»“æ„**:
```json
[
    {
        "copyId": "CS001_1",
        "indexId": "CS001",
        "copyNumber": 1,
        "borrowedBy": "",
        "borrowDate": "",
        "dueDate": ""
    }
]
```

### 7.2 æ•°æ®åŠ è½½æœºåˆ¶

**æ–‡ä»¶ä½ç½®**: `src/utils/librarymanager.cpp` - `LibraryManager::loadFromDatabase()`

**æ™ºèƒ½å‰¯æœ¬åˆ›å»º**:
```cpp
bool LibraryManager::loadFromDatabase()
{
    books_ = dbManager_.getAllBooks();

    // ç¡®ä¿æ¯æœ¬ä¹¦éƒ½æœ‰å‰¯æœ¬ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºé»˜è®¤å‰¯æœ¬
    for (const Book& book : books_) {
        QVector<BookCopy> existingCopies = copyManager_.getCopiesByIndexId(book.indexId);
        if (existingCopies.isEmpty()) {
            // åˆ›å»ºé»˜è®¤å‰¯æœ¬
            BookCopy copy;
            copy.copyId = book.indexId + "_1";
            copy.indexId = book.indexId;
            copy.copyNumber = 1;
            copyManager_.addCopy(copy);

            // æ ¹æ®å€Ÿé˜…æ¬¡æ•°åˆ›å»ºé¢å¤–å‰¯æœ¬
            int extraCopies = qMax(0, (book.borrowCount - 1) / 5);
            if (extraCopies > 0) {
                addBookCopies(book.indexId, extraCopies);
            }
        }
    }
}
```

---

## 8. UIç•Œé¢è®¾è®¡

### 8.1 ä¸»é¢˜ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®**: `src/widget/mainwindow.cpp` - `MainWindow::applyTheme()`

**æ”¯æŒçš„ä¸»é¢˜**:
- **æµ…è‰²ä¸»é¢˜**: æ¸…çˆ½çš„ç•Œé¢é£æ ¼ï¼Œé€‚åˆç™½å¤©ä½¿ç”¨
- **æ·±è‰²ä¸»é¢˜**: æŠ¤çœ¼çš„æš—è‰²ç•Œé¢ï¼Œé€‚åˆå¤œé—´ä½¿ç”¨

**ä¸»é¢˜åˆ‡æ¢å®ç°**:
```cpp
void MainWindow::applyTheme(bool isDark)
{
    QString styles = getThemeStyles(isDark);
    setStyleSheet(styles);

    // æ›´æ–°å·¦ä¾§åŠŸèƒ½æ å®¹å™¨çš„èƒŒæ™¯è‰²
    if (toolBarScrollArea_) {
        QWidget *toolContainer = toolBarScrollArea_->widget();
        if (toolContainer) {
            toolContainer->setStyleSheet(
                QString("background-color: %1;")
                .arg(isDark ? "#22333B" : "#FEEFF1")
            );
        }
    }
}
```

### 8.2 å“åº”å¼å¸ƒå±€

**å·¥å…·æ å¸ƒå±€**:
- æ”¯æŒç«–å‘ï¼ˆå·¦ä¾§ï¼‰å’Œæ¨ªå‘ï¼ˆé¡¶éƒ¨ï¼‰ä¸¤ç§å¸ƒå±€
- å¯é€šè¿‡`toggleToolBarOrientation()`å‡½æ•°åŠ¨æ€åˆ‡æ¢
- ä½¿ç”¨QScrollAreaå®ç°æ»šåŠ¨æ•ˆæœ

**è¡¨æ ¼æ˜¾ç¤º**:
- æ”¯æŒè¡¨å¤´ç‚¹å‡»æ’åº
- åŠ¨æ€æ˜¾ç¤ºç­›é€‰çŠ¶æ€
- è‡ªé€‚åº”åˆ—å®½

---

## 9. é”™è¯¯å¤„ç†æœºåˆ¶

### 9.1 æ•°æ®éªŒè¯

**è¾“å…¥éªŒè¯**:
- ç´¢å¼•å·å”¯ä¸€æ€§æ£€æŸ¥
- ä»·æ ¼èŒƒå›´éªŒè¯
- æ—¥æœŸæ ¼å¼å’ŒèŒƒå›´éªŒè¯
- ç”¨æˆ·åå’Œå¯†ç é•¿åº¦æ£€æŸ¥

**ä¸šåŠ¡é€»è¾‘éªŒè¯**:
- å€Ÿä¹¦æ—¶æ£€æŸ¥é‡å¤å€Ÿé˜…
- è¿˜ä¹¦æ—¶éªŒè¯å€Ÿé˜…è€…èº«ä»½
- åˆ é™¤å›¾ä¹¦æ—¶æ£€æŸ¥æ˜¯å¦æœ‰å€Ÿé˜…çš„å‰¯æœ¬

### 9.2 å¼‚å¸¸å¤„ç†

**æ–‡ä»¶æ“ä½œå¼‚å¸¸**:
```cpp
bool DatabaseManager::loadFromFile()
{
    QFile file(filePath_);
    if (!file.open(QIODevice::ReadOnly)) {
        qDebug() << "Cannot open file:" << file.errorString();
        return false;
    }
    // ... å¤„ç†æ–‡ä»¶å†…å®¹
}
```

**æ•°æ®åº“æ“ä½œå¼‚å¸¸**:
```cpp
bool LibraryManager::addBook(const Book &book, QString *error)
{
    if (findByIndexId(book.indexId)) {
        if (error) *error = QStringLiteral("ç´¢å¼•å· '%1' å·²å­˜åœ¨").arg(book.indexId);
        return false;
    }
    // ... ç»§ç»­å¤„ç†
}
```

---

## 10. æ€§èƒ½ä¼˜åŒ–

### 10.1 æ•°æ®ç¼“å­˜

**å†…å­˜ç¼“å­˜**:
- å›¾ä¹¦ä¿¡æ¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé¿å…é¢‘ç¹æ–‡ä»¶è¯»å–
- ä½¿ç”¨QVectorè¿›è¡Œé«˜æ•ˆçš„æ•°æ®è®¿é—®
- é‡‡ç”¨å•ä¾‹æ¨¡å¼ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

### 10.2 UIä¼˜åŒ–

**å»¶è¿ŸåŠ è½½**:
- å¤§é‡æ•°æ®æ—¶ä½¿ç”¨åˆ†é¡µæ˜¾ç¤º
- ç­›é€‰ç»“æœå®æ—¶æ›´æ–°ï¼Œé¿å…å…¨è¡¨é‡ç»˜

**ä¿¡å·æ§½æœºåˆ¶**:
- ä½¿ç”¨Qtçš„ä¿¡å·æ§½æœºåˆ¶å®ç°æ¾è€¦åˆ
- æ•°æ®å˜æ›´æ—¶é€šè¿‡emité€šçŸ¥UIæ›´æ–°

---

## 11. æ‰©å±•æ€§è®¾è®¡

### 11.1 æ¨¡å—åŒ–æ¶æ„

**æ ¸å¿ƒæ¨¡å—**:
- `LibraryManager`: å›¾ä¹¦ç®¡ç†æ ¸å¿ƒé€»è¾‘
- `DatabaseManager`: æ•°æ®æŒä¹…åŒ–
- `BookCopyManager`: å‰¯æœ¬ç®¡ç†
- `MainWindow`: ç”¨æˆ·ç•Œé¢

**æ¥å£è®¾è®¡**:
- æ¸…æ™°çš„å…¬å…±æ¥å£å®šä¹‰
- è‰¯å¥½çš„é”™è¯¯å¤„ç†æœºåˆ¶
- æ”¯æŒæœªæ¥çš„åŠŸèƒ½æ‰©å±•

### 11.2 é…ç½®ç®¡ç†

**å¯é…ç½®é¡¹**:
- æ•°æ®æ–‡ä»¶è·¯å¾„
- é»˜è®¤å€Ÿé˜…æœŸé™
- UIä¸»é¢˜è®¾ç½®
- ç­›é€‰å’Œæ’åºé€‰é¡¹

---

## 12. æµ‹è¯•ç”¨ä¾‹

### 12.1 åŠŸèƒ½æµ‹è¯•

**å€Ÿè¿˜ä¹¦æµç¨‹æµ‹è¯•**:
1. å­¦ç”Ÿå€Ÿä¹¦ â†’ å‰¯æœ¬çŠ¶æ€å˜æ›´ â†’ å€Ÿé˜…æ¬¡æ•°å¢åŠ 
2. å­¦ç”Ÿè¿˜ä¹¦ â†’ å‰¯æœ¬çŠ¶æ€æ¢å¤ â†’ æ•°æ®æ¸…ç†
3. é‡å¤å€Ÿé˜…æ£€æŸ¥ â†’ é˜²æ­¢é‡å¤å€Ÿé˜…åŒä¸€æœ¬ä¹¦

**ç­›é€‰æœç´¢æµ‹è¯•**:
1. å¤šæ¡ä»¶ç»„åˆç­›é€‰
2. æ¨¡ç³Šæœç´¢å‡†ç¡®æ€§
3. æ’åºåŠŸèƒ½æ­£ç¡®æ€§

### 12.2 æ€§èƒ½æµ‹è¯•

**å¤§æ•°æ®é‡æµ‹è¯•**:
- 1000+å›¾ä¹¦æ•°æ®çš„åŠ è½½é€Ÿåº¦
- æœç´¢å“åº”æ—¶é—´
- ç­›é€‰æ“ä½œæµç•…åº¦

---

## æ€»ç»“

æœ¬å›¾ä¹¦ç®¡ç†ç³»ç»Ÿé‡‡ç”¨ç°ä»£åŒ–çš„è®¾è®¡ç†å¿µå’Œæˆç†Ÿçš„Qtæ¡†æ¶ï¼Œå®ç°äº†å®Œæ•´çš„å›¾ä¹¦å€Ÿé˜…ç®¡ç†åŠŸèƒ½ã€‚ç³»ç»Ÿå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **ç²¾ç¡®å‰¯æœ¬ç®¡ç†**: å¼•å…¥å‰¯æœ¬æ¦‚å¿µï¼Œå®ç°ç²¾ç¡®åˆ°å…·ä½“å‰¯æœ¬çš„å€Ÿé˜…ç®¡ç†
2. **å¤šè§’è‰²æƒé™**: æ”¯æŒç®¡ç†å‘˜å’Œå­¦ç”Ÿçš„ä¸åŒæƒé™æ§åˆ¶
3. **æ™ºèƒ½æœç´¢ç­›é€‰**: å¤šç»´åº¦æœç´¢å’Œç­›é€‰åŠŸèƒ½
4. **ç”¨æˆ·å‹å¥½ç•Œé¢**: ç°ä»£åŒ–UIè®¾è®¡ï¼Œæ”¯æŒä¸»é¢˜åˆ‡æ¢
5. **æ•°æ®å®‰å…¨å¯é **: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ•°æ®æŒä¹…åŒ–æœºåˆ¶
6. **è‰¯å¥½çš„æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºåŠŸèƒ½æ‰©å±•

ç³»ç»Ÿä»£ç ç»“æ„æ¸…æ™°ï¼Œæ³¨é‡Šå®Œå–„ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•ï¼Œä¸ºå›¾ä¹¦é¦†ç®¡ç†æä¾›äº†é«˜æ•ˆå¯é çš„è§£å†³æ–¹æ¡ˆã€‚